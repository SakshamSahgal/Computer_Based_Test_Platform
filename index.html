<html>
<head>
    <title>CBT platform Homepage</title>
</head>
<body>
    <link rel="stylesheet" href="CSS/index.css">
    <div id="Top_Bar"> <h2 style="text-align:center ; padding-top: 15px;"> COMPUTER BASED TEST PLATFORM </h2></div>
    <div id="Login_box">
        <table id="login_table">
            <tr><td rowspan="5"><img src="../GUI_Resources/user_ui.png" style="margin: 20px;"></td><td style="text-align:center ; ">LOGIN</td></tr>
            <tr><td style="width: 400px;">Login as : <input type="radio" id = "login_as_Admin" name="login_as_choice" checked> Admin  <input type="radio" name="login_as_choice" id = "login_as_Student"> Student <input type="radio" name="login_as_choice" id = "login_as_Problem_Setter"> Problem Setter</td></tr>
            <tr> <td style="padding: 15px;" > User ID : <input type="text" id="input_uid"></td></tr>
            <tr><td style="padding: 15px;" >Password : <input type="text" id="input_pass"></td></tr>
            <tr><td style="text-align:center ;"><Button id="login_button" >Login</Button></td></tr>
        </table>
    </div>
</body>
<!-------------------------------------imports + configuration-------------------------------->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCyt3pQ5xUwzRSa1k4yPwGuJiPTjEJsNoY",
      authDomain: "cbtplatform-d2cb9.firebaseapp.com",
      projectId: "cbtplatform-d2cb9",
      storageBucket: "cbtplatform-d2cb9.appspot.com",
      messagingSenderId: "1071199320623",
      appId: "1:1071199320623:web:ef64a8442f32f01d84e4da"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    import {getDatabase, ref, get, set, child, update,remove} 
          from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js" ; //importing the functions 
        const db = getDatabase(); //getting the database

    //-----------------------------Refrences-----------------------------------//
    var login_as_Admin = document.getElementById("login_as_Admin"); 
    var login_as_Student = document.getElementById("login_as_Student");
    var login_as_Problem_Setter = document.getElementById("login_as_Problem_Setter");
    var input_uid = document.getElementById("input_uid");
    var input_pass = document.getElementById("input_pass");
    var login_button = document.getElementById("login_button");
    //--------------------------------------------------------------------------//

    function Login() //this funcition is called when user tries to log-in 
    {
        console.group("Login Details");
        console.log("Login as Details - " + login_as_Admin.checked + " " + login_as_Student.checked + " " + login_as_Problem_Setter.checked );
        console.log("user id = " + input_uid.value);
        console.log("pass = " + input_pass.value);
        console.groupEnd("Login Details");

        if(login_as_Admin.checked) //if login as admin is checked
        {
            if(input_uid.value != "" && input_pass.value != "") //if input fields are not empty
            {
                const dbref = ref(db); //getting a refrence to the DB
                get(child(dbref,"Admins/"+ input_uid.value)).then((snapshot)=>{
                if(snapshot.exists() && snapshot.val().Password == input_pass.value) //if this record exists and user id and password matches
                {
                    console.log("Logged in");
                }
                else
                alert("Wrong UserID/Password");
                })
                .catch((error)=>{
                    alert("unsuccessful, error = " + error);
                });
            }
            else
                alert("Please Enter Values");
        }
        
    }

     //-------------Assignments----------------------//
     login_button.addEventListener('click',Login);
  </script>

</html>